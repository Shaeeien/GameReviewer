@model Game
@using Microsoft.AspNetCore.Mvc;
@using System.Web;
@inject IHttpContextAccessor httpContextAccessor

<h1>@Model.Name</h1>
@*Tutaj będą fotki*@
<div>
    @using(ImageRepository repo = new ImageRepository(new ReviewContext())){
        foreach(Image img in repo.GetAll()){
            if(img.GameId == Model.Id && img.Data != null){
                <img src="data:image/jpeg;base64,@Convert.ToBase64String(img.Data)" />
            }
        }
    }
</div>
<div>Średni czas gry(w godzinach): @Model.AvgPlayTimeInHours</div>
<div>
    <textarea style="resize: none; width:500px; height:500px;" readonly>@Model.Description</textarea>
</div>
<br />
@if(httpContextAccessor != null){
    @if (httpContextAccessor.HttpContext != null)
        @if (httpContextAccessor.HttpContext.Session.GetString("Login") != null)
        {
            <p>Komentujesz, jako @httpContextAccessor.HttpContext.Session.GetString("Login")</p>
            <form asp-action="AddReview" asp-controller="User">
                <input type="hidden" name="user" value="@Context.Session.GetString("Login")" />
                <input type="hidden" name="gameId" value="@Model.Id" />
                <textarea name="review" style="resize: none; width:500px; height:500px;"></textarea>
                <select name="rating">
                    <option>1.0</option>
                    <option>1.5</option>
                    <option>2.0</option>
                    <option>2.5</option>
                    <option>3.0</option>
                    <option>3.5</option>
                    <option>4.0</option>
                    <option>4.5</option>
                    <option selected>5.0</option>
                </select>
                <button type="submit">Dodaj recenzję</button>
            </form>
        }
}
@*Tutaj będą wyświetlone komentarze już zamieszczone, zrobić seeding przykładowymi danymi*@
<div>
    @using(ReviewsRepository repo = new ReviewsRepository()){
        @foreach(Review review in repo.GetAll()){
            <div>
                Data: @review.CommentDate <br />
                @review.User.UserName pisze: <br />
                <div>
                    @review.ReviewContent
                </div>
                @foreach(ReviewResponse response in repo.GetResponses(review)){
                    <div>
                        @response.User.UserName odpowiedział:
                        @response.ResponseContent
                    </div>
                }
            </div>
        }
    }
</div>
